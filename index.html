<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: black; overflow: hidden;
        }
        
        /* Ez a konténer, amibe elrejtjük a cuccot */
        #shadow-host {
            width: 100vw; height: 100vh;
            display: block;
        }
    </style>
</head>
<body>

    <div id="shadow-host"></div>

    <script>
        // URL paraméter
        const urlParams = new URLSearchParams(window.location.search);
        const videoUrl = urlParams.get('url');

        // 1. LÉTREHOZZUK A ZÁRT ÁRNYÉK DOM-OT (Shadow DOM)
        // A "mode: 'closed'" a kulcs! Ez elvileg kizárja a külső szkripteket.
        const host = document.getElementById('shadow-host');
        const shadow = host.attachShadow({ mode: 'closed' });

        // 2. Stílusok a bunker belsejében
        const style = document.createElement('style');
        style.textContent = `
            :host { display: block; width: 100%; height: 100%; position: relative; }
            
            /* A videó kitölti a teret */
            video {
                width: 100%; height: 100%;
                object-fit: contain;
                background: black;
            }
            
            /* Natív vezérlők tiltása */
            video::-webkit-media-controls { display: none !important; }
            
            /* Saját gomb réteg */
            .overlay {
                position: absolute; top: 0; left: 0;
                width: 100%; height: 100%;
                display: flex; justify-content: center; align-items: center;
                z-index: 10; cursor: pointer;
            }
            .btn {
                padding: 20px 40px; background: red; color: white;
                font-size: 24px; border-radius: 10px; border: 2px solid white;
                font-family: sans-serif; font-weight: bold;
                display: none; /* Alapból rejtve */
            }
        `;
        shadow.appendChild(style);

        // 3. A Videó elem létrehozása
        const video = document.createElement('video');
        video.setAttribute('playsinline', '');
        video.setAttribute('webkit-playsinline', '');
        shadow.appendChild(video);

        // 4. Saját gomb (hogy tudj indítani)
        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.innerText = 'LEJÁTSZÁS';
        btn.style.display = 'block'; // Kezdéskor látszik
        
        overlay.appendChild(btn);
        shadow.appendChild(overlay);

        // 5. Logika
        if (videoUrl) {
            if (Hls.isSupported() && videoUrl.includes('.m3u8')) {
                const hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(video);
            } else {
                video.src = videoUrl;
            }
        } else {
            btn.innerText = "Nincs URL!";
        }

        // Kattintás kezelés a bunkerben
        overlay.addEventListener('click', (e) => {
            e.stopPropagation(); // Ne engedjük ki a kattintást a bunkerből!
            
            if (video.paused) {
                video.play().then(() => {
                    btn.style.display = 'none';
                }).catch(err => alert(err));
            } else {
                video.pause();
                btn.style.display = 'block';
            }
        });

        // Megpróbáljuk letiltani a jobb klikket/menüt is
        host.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
