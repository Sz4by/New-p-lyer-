<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Control Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: black; overflow: hidden;
        }
        /* A konténer */
        #safe-zone {
            width: 100vw; height: 100vh;
            display: block;
        }
    </style>
</head>
<body>

    <div id="safe-zone"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const videoUrl = urlParams.get('url');

        // 1. SHADOW DOM LÉTREHOZÁSA (A rejtekhely)
        const host = document.getElementById('safe-zone');
        const shadow = host.attachShadow({ mode: 'closed' });

        // 2. STÍLUSOK
        const style = document.createElement('style');
        style.textContent = `
            @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css');
            
            :host { display: block; width: 100%; height: 100%; position: relative; font-family: sans-serif; }
            
            video {
                width: 100%; height: 100%;
                object-fit: contain; background: black;
            }
            video::-webkit-media-controls { display: none !important; }

            /* Nagy Play ikon (Indításkor/Szünetnél) */
            .big-icon {
                position: absolute; top: 50%; left: 50%;
                transform: translate(-50%, -50%);
                font-size: 100px; color: rgba(255,255,255,0.8);
                text-shadow: 0 0 20px black;
                pointer-events: none; z-index: 20;
                display: none; /* Alapból rejtve */
            }

            /* Vezérlősáv */
            .controls {
                position: absolute; bottom: 0; left: 0;
                width: 100%; height: 80px;
                background: rgba(0,0,0,0.9);
                display: flex; align-items: center;
                padding: 0 30px; box-sizing: border-box;
                z-index: 30; transition: opacity 0.3s;
            }
            
            button {
                background: none; border: none; color: white;
                font-size: 24px; width: 50px; text-align: center;
            }
            
            .time { color: white; font-size: 18px; margin: 0 20px; min-width: 110px; text-align: center; }

            /* Csúszka */
            .seek-container { flex-grow: 1; margin: 0 20px; display: flex; align-items: center; }
            input[type=range] {
                -webkit-appearance: none; width: 100%; height: 8px;
                background: #555; border-radius: 5px; outline: none;
            }
            input[type=range]::-webkit-slider-thumb {
                -webkit-appearance: none; width: 20px; height: 20px;
                background: red; border-radius: 50%; border: 2px solid white;
            }

            .hidden { opacity: 0; }
        `;
        shadow.appendChild(style);

        // 3. HTML FELÉPÍTÉS
        const container = document.createElement('div');
        container.style.width = '100%'; container.style.height = '100%'; container.style.position = 'relative';

        container.innerHTML = `
            <div id="center-icon" class="big-icon"><i class="fas fa-play"></i></div>
            
            <video id="v" playsinline webkit-playsinline></video>

            <div id="controls" class="controls">
                <button id="btn-play"><i class="fas fa-play"></i></button>
                <div class="time"><span id="cur">0:00</span> / <span id="dur">0:00</span></div>
                <div class="seek-container">
                    <input type="range" id="seek" min="0" value="0" step="1">
                </div>
            </div>
        `;
        shadow.appendChild(container);

        // 4. LOGIKA
        const vid = container.querySelector('#v');
        const centerIcon = container.querySelector('#center-icon');
        const btnPlay = container.querySelector('#btn-play');
        const seek = container.querySelector('#seek');
        const curText = container.querySelector('#cur');
        const durText = container.querySelector('#dur');
        const controlsDiv = container.querySelector('#controls');

        // Betöltés
        if (videoUrl) {
            if (Hls.isSupported() && videoUrl.includes('.m3u8')) {
                const hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(vid);
            } else {
                vid.src = videoUrl;
            }
        } else {
            centerIcon.innerHTML = "Nincs URL";
            centerIcon.style.display = 'block';
        }

        // --- VEZÉRLÉS FUNKCIÓK ---

        function togglePlay() {
            if (vid.paused) {
                vid.play();
                centerIcon.style.display = 'none';
                btnPlay.innerHTML = '<i class="fas fa-pause"></i>';
                resetTimer(); // Sáv megjelenítése
            } else {
                vid.pause();
                centerIcon.innerHTML = '<i class="fas fa-play"></i>'; // Play ikon
                centerIcon.style.display = 'block';
                btnPlay.innerHTML = '<i class="fas fa-play"></i>';
                controlsDiv.classList.remove('hidden'); // Sáv maradjon kint
            }
        }

        function seekVideo(seconds) {
            vid.currentTime = Math.max(0, Math.min(vid.duration, vid.currentTime + seconds));
            
            // Vizuális visszajelzés (ikon középen)
            centerIcon.style.display = 'block';
            if (seconds > 0) centerIcon.innerHTML = '<i class="fas fa-forward"></i> +10s';
            else centerIcon.innerHTML = '<i class="fas fa-backward"></i> -10s';
            
            // Kis idő múlva eltüntetjük az ikont
            setTimeout(() => {
                if (!vid.paused) centerIcon.style.display = 'none';
            }, 800);
            
            resetTimer();
        }

        // --- TÁVIRÁNYÍTÓ GOMBOK KEZELÉSE ---
        // Ez a rész figyeli a Fire TV távirányítót
        document.addEventListener('keydown', (e) => {
            const key = e.key;
            const code = e.keyCode;

            // Debugoláshoz (ha kellene): console.log("Gomb:", key, code);

            // 1. KÖZÉPSŐ GOMB (OK / ENTER) vagy PLAY/PAUSE GOMB
            if (key === 'Enter' || code === 13 || code === 179 || key === 'MediaPlayPause') {
                togglePlay();
                e.preventDefault(); // Ne kattintson sehova máshova
            }

            // 2. JOBBRA NYÍL vagy FAST FORWARD (Tekerés előre 10mp)
            if (key === 'ArrowRight' || code === 39 || code === 228 || key === 'MediaFastForward') {
                seekVideo(10);
                e.preventDefault();
            }

            // 3. BALRA NYÍL vagy REWIND (Tekerés hátra 10mp)
            if (key === 'ArrowLeft' || code === 37 || code === 227 || key === 'MediaRewind') {
                seekVideo(-10);
                e.preventDefault();
            }
            
            // 4. SPACE (Billentyűzethez)
            if (code === 32) {
                togglePlay();
                e.preventDefault();
            }
        });

        // Egér/Touch események
        btnPlay.addEventListener('click', togglePlay);
        centerIcon.addEventListener('click', togglePlay);
        
        // Idő frissítése
        function formatTime(s) {
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        vid.addEventListener('timeupdate', () => {
            if (!isNaN(vid.duration)) {
                seek.max = vid.duration;
                durText.innerText = formatTime(vid.duration);
            }
            seek.value = vid.currentTime;
            curText.innerText = formatTime(vid.currentTime);
        });

        seek.addEventListener('input', () => {
            vid.currentTime = seek.value;
            resetTimer();
        });

        // Inaktivitás kezelése (Sáv elrejtése)
        let timer;
        function resetTimer() {
            controlsDiv.classList.remove('hidden');
            clearTimeout(timer);
            timer = setTimeout(() => {
                if (!vid.paused) controlsDiv.classList.add('hidden');
            }, 4000);
        }
        container.addEventListener('mousemove', resetTimer);
        container.addEventListener('click', resetTimer);

    </script>
</body>
</html>
